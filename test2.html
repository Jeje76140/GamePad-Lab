<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Afficheur Manette PS4</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #282c34; color: white; }
        .controller { position: relative; width: 806px; height: 598px; margin: 50px auto; background: url("https://jeje76140.github.io/PS4_CONTROLLER/Akatsuki/manette.png") no-repeat center; background-size: cover; }
        .ds4.disconnected { background: url("https://jeje76140.github.io/PS4_CONTROLLER/disconnected.png"); }
        .ds4.disconnected div { display: none; }
        .abxy, .bumpers, .triggers, .dpad, .share-options, .touchpad { position: absolute; }

        /* Les boutons sont cachés par défaut */
        .button, .bumper, .trigger, .face, .back, .start {
            display: none;
        }

        .abxy { width: 170px; height: 171px; top: 159px; left: 570px; }
        .button { position: absolute; width: 55px; height: 55px; background: url("https://jeje76140.github.io/PS4_CONTROLLER/Akatsuki/button.png"); }
        .button.pressed { display: block; background-position-y: 55px; }
        .a { background-position: 0 0; bottom: 0; left: 58px; }
        .b { background-position: -57px 0; top: 58px; right: 0px; }
        .x { background-position: -113px 0; top: 58px; left: 0px; }
        .y { background-position: 55px 0; left: 58px; }

        .bumpers { width: 588px; height: 23px; left: 109px; top: 95px; }
        .bumper { width: 99px; height: 23px; background: url("https://jeje76140.github.io/PS4_CONTROLLER/Akatsuki/bumper.png") no-repeat; opacity: 0; }
        .bumper.pressed { display: block; }
        .bumper.left { float: left; }
        .bumper.right { float: right; position: absolute; left: 492px; transform: rotateY(180deg); }

        .triggers { width: 588px; height: 90px; left: 109px; }
        .trigger { width: 99px; height: 100%; background: url("https://jeje76140.github.io/PS4_CONTROLLER/Akatsuki/tricker.png"); opacity: 0; }
        .trigger.left { float: left; }
        .trigger.right { float: right; background-position-x: 99px; }
        .trigger.pressed { display: block; }

        .dpad { width: 126px; height: 126px; top: 189px; left: 82px; }
        .face { background: url("https://jeje76140.github.io/PS4_CONTROLLER/Akatsuki/arrows.png"); position: absolute; }
        .face.up { width: 52px; height: 63px; left: 44px; top: -14px; background-position: -52px 126px; }
        .face.down { width: 52px; height: 63px; left: 44px; bottom: 0px; background-position: 0px 0; }
        .face.left { width: 63px; height: 63px; top: 20px; left: 0px; background-position: -104px 126px; }
        .face.right { width: 63px; height: 63px; top: 18px; right: -14px; background-position: 63px 0; }
        .face.pressed { background-position-y: 63px; }

        .share-options { width: 352px; height: 46px; top: 142px; left: 227px; }
        .back, .start { background: url("https://jeje76140.github.io/PS4_CONTROLLER/Akatsuki/start-select.png"); width: 27px; height: 47px; opacity: 0; }
        .back.pressed, .start.pressed { display: block; }
        .back { float: left; position: absolute; left: -3px; top: -3px; }
        .start { float: right; position: absolute; left: 330px; top: -3px; transform: rotateY(180deg); background-position: 27px 0; }

        .touchpad { width: 265px; height: 152px; left: 272px; top: 123px; }
        .touchpad.pressed { background: url("https://jeje76140.github.io/PS4_CONTROLLER/Akatsuki/pad.png") no-repeat center; }
    </style>
</head>
<body>
    <h1>Afficheur Manette PS4</h1>
    <div class="controller ds4 disconnected">
        <div class="abxy">
            <span class="button a" data-name="button-cross"></span>
            <span class="button b" data-name="button-circle"></span>
            <span class="button x" data-name="button-square"></span>
            <span class="button y" data-name="button-triangle"></span>
        </div>

        <div class="bumpers">
            <span class="bumper left" data-name="button-l1"></span>
            <span class="bumper right" data-name="button-r1"></span>
        </div>

        <div class="triggers">
            <span class="trigger left" data-name="button-l2"></span>
            <span class="trigger right" data-name="button-r2"></span>
        </div>

        <div class="dpad">
            <span class="face up" data-name="button-dpad-top"></span>
            <span class="face down" data-name="button-dpad-bottom"></span>
            <span class="face left" data-name="button-dpad-left"></span>
            <span class="face right" data-name="button-dpad-right"></span>
        </div>

        <div class="share-options">
            <span class="back" data-name="button-share"></span>
            <span class="start" data-name="button-options"></span>
        </div>

        <div class="touchpad" data-name="touch-pad"></div>
    </div>
    <script>
        window.addEventListener("gamepadconnected", () => {
            document.querySelector(".controller").classList.remove("disconnected");
            updateGamepad();
        });

        function updateGamepad() {
            const gp = navigator.getGamepads()[0];
            if (!gp) return;

            document.querySelectorAll("[data-name]").forEach(el => {
                const buttonIndex = el.dataset.name.split("-")[1]; // On récupère le bouton correspondant
                if (gp.buttons[buttonIndex]) {
                    const isPressed = gp.buttons[buttonIndex]?.pressed;
                    if (isPressed) {
                        el.classList.add("pressed");  // On ajoute la classe pour afficher le bouton
                        el.style.display = "block";    // On rend le bouton visible
                    } else {
                        el.classList.remove("pressed"); // On enlève la classe pour masquer le bouton
                        el.style.display = "none";        // On cache le bouton
                    }
                }
            });

            requestAnimationFrame(updateGamepad);  // On met à jour la manette à chaque frame
        }
    </script>
</body>
</html>
